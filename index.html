<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="styles.css">
  <meta name="description" content="Future Inventions is a research and development lab prototyping liberatory Afro-technological futures through workshops, reading groups, and digital experiments connecting creative technologists, thinkers, and communities across London, Abuja, and online.">
  <title>Future Inventions Lab | Afro-Technological Futures Research & Community</title>
  <meta property="og:title" content="Future Inventions Lab" />
  <meta property="og:description" content="Prototyping liberatory Afro-technological futures through creative research and community." />
  <meta property="og:image" content="/images/sankofa-blue.png" />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://future-inventions.net" />
  <link rel="icon" href="/images/favicon.ico" type="image/x-icon">
  <link rel="apple-touch-icon" href="/images/favicon.png">
  <meta name="theme-color" content="#372FD1">
  <link rel="canonical" href="https://future-inventions.net/">
  <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
</head>
<body>
  <header>
    <div style="margin: 2rem 0">
      <h1 style="font-size: 48px; text-align: center; margin: 0">Future Inventions</h1>
      <p style="text-align: center; margin: 0; font-size: 14px;" >London - Abuja - Online</p>
    </div>
    <nav class="tabs">
      <div class="tab active" data-tab="home">Home</div>
      <div class="tab" data-tab="upcoming">Upcoming</div>
      <div class="tab" data-tab="archive">Archive</div>
      <div class="tab" data-tab="about">About</div>
      <div class="tab" data-tab="contact">Contact</div>
    </nav>
  </header>

  <main>
    <section id="home" class="tab-content active">
      <div class="intro-text">
        <p><strong style="font-size: 32px;">Future Inventions</strong> is a research & development lab, a community tech school, and 
          a community of creative technologists, thinkers, and curious individuals who are invested in prototyping alternatives to what we understand as technology today</p>
        </p>
      </div>
      <img src="/images/sankofa.png" alt="Future Inventions Logo" class="logo" style="width: 400px; height: auto;">
    </section>

    <section id="upcoming" class="tab-content">
      <h1>Upcoming Events</h1>
      <div id="upcoming-events">Loading upcoming events...</div>
    </section>

    <section id="archive" class="tab-content">
      <h1>Past Events</h1>
      <div id="archive-events">Loading archive events...</div>
    </section>

    <section id="about" class="tab-content">
      <div id="about-content">Loading about page...</div>
    </section>

    <section id="contact" class="tab-content">
      <div id="contact-content">Loading contact page...</div>
    </section>
  </main>

  <script>
    // --- Tab logic ---
    const tabs = document.querySelectorAll('.tab');
    const contents = document.querySelectorAll('.tab-content');

    async function fetchSessions() {
      try {
        // Fetch the index first
        const indexRes = await fetch('/_index/sessions-list.json');
        if (!indexRes.ok) throw new Error('Failed to fetch session index');
        
        const { sessions: sessionSlugs } = await indexRes.json();

        // Fetch each session JSON file based on its slug
        const sessions = await Promise.all(
          sessionSlugs.map(async (slug) => {
            const res = await fetch(`/_sessions/${slug}.json`);
            if (!res.ok) throw new Error(`Failed to fetch session: ${slug}`);
            return await res.json();
          })
        );

        return sessions;
      } catch (err) {
        console.error('Error fetching sessions:', err);
        return [];
      }
    }

    function showTab(tabName) {
      contents.forEach(c => c.classList.remove('active'));
      const activeSection = document.getElementById(tabName);
      if (activeSection) activeSection.classList.add('active');

      tabs.forEach(t => t.classList.remove('active'));
      tabs.forEach(t => { if (t.dataset.tab === tabName) t.classList.add('active'); });
    }

    // --- Handle tab clicks ---
    tabs.forEach(tab => {
      tab.addEventListener('click', e => {
        const tabName = tab.dataset.tab;

        // Update URL without reloading
        // history.pushState({ tab: tabName }, '', '/' + tabName);

        // Show the selected tab
        showTab(tabName);
      });
    });

    // --- Handle browser back/forward ---
    // window.addEventListener('popstate', e => {
    //   const tabName = e.state?.tab || 'home';
    //   showTab(tabName);
    // });

    // // --- Show correct tab on initial load ---
    // window.addEventListener('DOMContentLoaded', () => {
    //   const path = window.location.pathname.replace('/', '') || 'home';
    //   showTab(path);
    // });
    function slugify(title) {
      return title.toLowerCase().replace(/\s+/g, '-').replace(/[^\w\-]+/g, '');
    }

    function renderSessions(list, containerId, reverse = false) {
      const container = document.getElementById(containerId);
      container.innerHTML = '';

      const newList = reverse ? list.slice().reverse() : list;

      newList.forEach(item => {
        const slug = slugify(item.title);
        const el = document.createElement('div');
        el.className = 'session';
        el.innerHTML = `
          <img src="${item.thumbnail}" alt="${item.title}" style="width: 400px; height: auto;">
          <div>
            <h2>${item.title}</h2>
            <p><strong>${new Date(item.date).toLocaleDateString()}</strong></p>
            <p>Venue: ${item.venue}</p>
            <a href="/sessions.html?file=${slug}">Read Details</a>
          </div>
        `;
        container.appendChild(el);
      });
    }

    (async () => {
      const now = new Date();
      const sessions = await fetchSessions();

      const upcoming = sessions.filter(s => new Date(s.date) >= now);
      const archive  = sessions.filter(s => new Date(s.date) < now);

      renderSessions(upcoming, 'upcoming-events');
      renderSessions(archive, 'archive-events', true);
    })();

    function parseMarkdown(markdown) {
      if (!markdown) return '';

      return markdown
        // Convert headings: ## Heading → <h2>Heading</h2>
        .replace(/^### (.*$)/gim, '<h3>$1</h3>')
        .replace(/^## (.*$)/gim, '<h2>$1</h2>')
        .replace(/^# (.*$)/gim, '<h1>$1</h1>')
        // Bold: **text**
        .replace(/\*\*(.*?)\*\*/gim, '<strong>$1</strong>')
        // Italic: *text*
        .replace(/\*(.*?)\*/gim, '<em>$1</em>')
        // Links: [text](url)
        .replace(/\[([^\]]+)\]\(([^)]+)\)/gim, '<a href="$2" target="_blank">$1</a>')
        // Line breaks: two newlines → paragraph
        .replace(/\n\s*\n/g, '</p><p>')
        // Single newlines → <br>
        .replace(/\n/g, '<br>')
        // Wrap whole block in <p>
        .replace(/^(.+)$/gim, '<p>$1</p>');
    }

    function renderPageContent(pageTitle, containerId) {
      fetch(`/_pages/${pageTitle}.json`)
        .then(res => {
          if (!res.ok) throw new Error('Failed to fetch about page');
          return res.json();
        })
        .then(data => {
          const container = document.getElementById(containerId);
          const img = data.thumbnail ? `<img src="${data.thumbnail}" alt="${data.title}" style="max-width: 70%; height: auto; margin-bottom: 1rem;">` : '';
          container.innerHTML = `
            <h1>${data.title}</h1>
            <br/>
            ${img}
            <p>${parseMarkdown(data.body)}</p>
          `;
        })
        .catch(err => {
          console.error('Error loading page:', err);
          document.getElementById(containerId).innerText = 'Error loading page.';
        });
    }

    renderPageContent('about', 'about-content');
    renderPageContent('contact', 'contact-content');

    if (window.netlifyIdentity) {
      window.netlifyIdentity.on("init", (user) => {
        if (!user) {
          window.netlifyIdentity.on("login", () => {
            document.location.href = "/admin/";
          });
        }
      });
    }
  </script>

</body>
</html>